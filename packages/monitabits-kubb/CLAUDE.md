# CLAUDE.md

This file provides guidance for working with the Monitabits Kubb package.

## Package Overview

**@repo/monitabits-kubb** generates TypeScript types, SWR hooks, and Zod schemas from the OpenAPI specification using Kubb. This package is automatically regenerated when the API starts in development mode.

## Essential Commands

```bash
bun run kubb        # Manually regenerate from openapi.yaml
bun run check:types # Run TypeScript type checking
bun run check       # Run Biome linter/formatter
```

## How It Works

1. **API starts in dev mode** (`apps/monitabits-api`)
2. **OpenAPI spec generated** from NestJS `@ApiProperty` decorators
3. **Written to** `src/openapi.yaml`
4. **Kubb runs automatically** and regenerates `src/gen/`

## Package Structure

```
packages/monitabits-kubb/
├── kubb.config.ts        # Kubb code generation config
├── src/
│   ├── openapi.yaml      # OpenAPI spec (auto-generated by API)
│   ├── mutator.ts        # HTTP client for generated hooks
│   └── gen/              # Generated code (do not edit)
│       ├── types/        # TypeScript type definitions
│       ├── hooks/        # SWR hooks for data fetching
│       └── zod/          # Zod validation schemas
└── package.json
```

## Usage in Frontend

### Import Generated Hooks

```typescript
import { useSettingsControllerGetSettings } from '@repo/monitabits-kubb/gen/hooks';
import { useSessionsControllerCheckIn } from '@repo/monitabits-kubb/gen/hooks';

function MyComponent() {
  const { data, error, isLoading } = useSettingsControllerGetSettings();
  
  if (isLoading) return <div>Loading...</div>;
  if (error) return <div>Error: {error.message}</div>;
  
  return <div>{JSON.stringify(data)}</div>;
}
```

### Import Generated Types

```typescript
import type { Session, Settings, Action } from '@repo/monitabits-kubb/gen/types';
```

### Import Zod Schemas

```typescript
import { settingsDtoSchema } from '@repo/monitabits-kubb/gen/zod';
```

## HTTP Client (Mutator)

The `mutator.ts` provides the HTTP client used by generated hooks. It automatically:
- Adds `X-Device-Id` header
- Adds `X-Client-Time` header (ISO-8601)
- Uses API base URL from environment

## Package Exports

```typescript
"./mutator"     → src/mutator.ts
"./gen/hooks"   → src/gen/hooks/index.ts
"./gen/types"   → src/gen/types/index.ts
"./gen/zod"     → src/gen/zod/index.ts
```

## Development Notes

- **Never edit generated files** - They are overwritten on each generation
- **Source of truth** is the API's `@ApiProperty` decorators
- **Regeneration happens automatically** when API starts in dev mode
- **Manual regeneration**: Run `bun run kubb` if needed

## Related Documentation

- **[apps/monitabits-api/CLAUDE.md](../../apps/monitabits-api/CLAUDE.md)** - API with DTOs and OpenAPI generation
- **[apps/monitabits-swagger/README.md](../../apps/monitabits-swagger/README.md)** - Swagger UI documentation
